<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Way of Tea — An Interactive Exploration of Chanoyu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --zen-primary: #FDFBF5;
            --zen-secondary: #F0EAD6;
            --zen-accent: #6B8E23;
            --zen-highlight: #DAA520;
            --zen-text: #3a3a3a;
            --zen-text-light: #666666;
        }
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, var(--zen-primary) 0%, var(--zen-secondary) 100%);
            color: var(--zen-text);
            min-height: 100vh;
        }
        .nav-pill {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            border: 2px solid transparent;
        }
        .nav-pill:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(107, 142, 35, 0.15);
            border-color: var(--zen-accent);
        }
        .nav-pill.active {
            background: var(--zen-accent);
            color: white;
            border-color: var(--zen-accent);
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            border: 1px solid rgba(107, 142, 35, 0.1);
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(107, 142, 35, 0.12);
            border-color: var(--zen-accent);
        }
        .timeline-dot {
            position: absolute;
            left: -10px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--zen-highlight);
            border: 3px solid var(--zen-accent);
            z-index: 1;
        }
        .accordion-btn {
            width: 100%;
            text-align: left;
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: var(--zen-text);
            font-size: 0.875rem;
            font-weight: 500;
            transition: color 0.2s;
        }
        .accordion-btn:hover {
            color: var(--zen-accent);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .accordion-content.open {
            max-height: 500px;
        }
        .accordion-icon {
            transition: transform 0.3s;
        }
        .accordion-icon.rotate {
            transform: rotate(180deg);
        }
        /* Optimize accordion performance */
        .accordion-wrapper {
            will-change: height;
        }
        .search-highlight {
            background-color: #fef3c7;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .filter-badge {
            padding: 0.375rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            transition: all 0.2s;
            cursor: pointer;
            background: white;
            border: 2px solid var(--zen-secondary);
            color: var(--zen-text);
        }
        .filter-badge:hover {
            transform: scale(1.05);
            border-color: var(--zen-accent);
        }
        .filter-badge.active {
            background: var(--zen-accent);
            color: white;
            border-color: var(--zen-accent);
        }
        .section-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
            border: 1px solid rgba(107, 142, 35, 0.15);
        }
        .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }
        .temple-card {
            cursor: pointer;
            background: white;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .temple-card:hover {
            border-color: var(--zen-accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(107, 142, 35, 0.15);
        }
        .golden-accent {
            color: var(--zen-highlight);
        }
        
        .zen-button {
            background: var(--zen-accent);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        .zen-button:hover {
            background: #5a7a1f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(107, 142, 35, 0.3);
        }
        
        .translator-box {
            background: linear-gradient(135deg, white 0%, var(--zen-secondary) 100%);
            border: 2px solid var(--zen-accent);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(107, 142, 35, 0.15);
        }
        
        .translator-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--zen-secondary);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }
        .translator-input:focus {
            outline: none;
            border-color: var(--zen-accent);
            box-shadow: 0 0 0 3px rgba(107, 142, 35, 0.1);
        }
        
        .translator-result {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            border: 1px solid var(--zen-secondary);
            min-height: 100px;
        }
        
        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--zen-secondary);
            border-radius: 9999px;
            font-size: 0.75rem;
            color: var(--zen-text);
            margin: 0.125rem;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, var(--zen-secondary) 0%, rgba(218, 165, 32, 0.1) 100%);
            border-left: 4px solid var(--zen-highlight);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b-2 border-zen-accent/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between py-4">
                <h1 class="text-2xl font-bold" style="color: var(--zen-accent);">
                    <span class="golden-accent">茶の湯</span> The Way of Tea
                </h1>
                <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-gray-100">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
            <!-- Navigation -->
            <nav id="nav-menu" class="hidden md:flex flex-wrap gap-2 pb-3">
                <button class="nav-pill nav-btn px-4 py-2 rounded-full text-sm font-medium" data-section="overview">
                    Overview
                </button>
                <button class="nav-pill nav-btn px-4 py-2 rounded-full text-sm font-medium" data-section="translator">
                    茶道 Translator
                </button>
                <button class="nav-pill nav-btn px-4 py-2 rounded-full text-sm font-medium" data-section="timeline">
                    Timeline
                </button>
                <button class="nav-pill nav-btn px-4 py-2 rounded-full text-sm font-medium" data-section="roles">
                    Roles
                </button>
                <button class="nav-pill nav-btn px-4 py-2 rounded-full text-sm font-medium" data-section="temples">
                    Temples
                </button>
                <button class="nav-pill nav-btn px-4 py-2 rounded-full text-sm font-medium" data-section="monks">
                    Monks & Bokuseki
                </button>
                <button class="nav-pill nav-btn px-4 py-2 rounded-full text-sm font-medium" data-section="utensils">
                    Utensils Explorer
                </button>
                <button class="nav-pill nav-btn px-4 py-2 rounded-full text-sm font-medium" data-section="provenance">
                    Provenance & Hakogaki
                </button>
                <button class="nav-pill nav-btn px-4 py-2 rounded-full text-sm font-medium" data-section="events">
                    Temple Events
                </button>
                <button class="nav-pill nav-btn px-4 py-2 rounded-full text-sm font-medium" data-section="toriawase">
                    Toriawase Lab
                </button>
            </nav>
        </div>
    </header>



    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Overview Section -->
        <section id="overview" class="content-section mb-12">
            <div class="section-card">
                <h2 class="text-3xl font-bold mb-4" style="color: var(--zen-accent);">Chanoyu, Temples, and the Modern Collecting Ecosystem</h2>
                <div class="prose max-w-none text-gray-700">
                    <p class="mb-4">
                        Chanoyu emerged from Zen monasteries as a practical aid to meditation and matured—through merchants, monks, and tea masters—into a codified aesthetic and social practice. This interactive guide presents an integrated, richly detailed map of that world.
                    </p>
                    <div class="grid md:grid-cols-3 gap-4 mt-6">
                        <div class="highlight-box">
                            <h3 class="font-semibold mb-2 golden-accent">Temple Centrality</h3>
                            <p class="text-sm">Daitoku-ji and peers host public <em>tsukigama</em>, memorials, and <em>kencha</em>, while abbots provide bokuseki and endorsements.</p>
                        </div>
                        <div class="highlight-box">
                            <h3 class="font-semibold mb-2 golden-accent">Wabi-cha Aesthetics</h3>
                            <p class="text-sm">From Murata Jukō to Rikyū—small huts, rustic materials, moral clarity—distinct from earlier <em>karamono</em> display culture.</p>
                        </div>
                        <div class="highlight-box">
                            <h3 class="font-semibold mb-2 golden-accent">Collector's Lens</h3>
                            <p class="text-sm">Canon, diagnostics, and <em>denrai</em> (provenance) converge in the box inscription (<em>hakogaki</em>).</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Translator Section -->
        <section id="translator" class="content-section mb-12">
            <div class="section-card">
                <h2 class="text-3xl font-bold mb-6" style="color: var(--zen-accent);">茶道 Tea Ceremony Translator</h2>
                <div class="translator-box">
                    <p class="text-sm mb-4" style="color: var(--zen-text-light);">
                        Enter any Japanese term, romaji, or English word related to tea ceremony. Get instant translations, kanji, and cultural context.
                    </p>
                    <input type="text" id="translator-input" class="translator-input" 
                        placeholder="Try: 'wabi', '茶碗', 'tea bowl', 'ichigo ichie', or any tea term...">
                    <div id="translator-result" class="translator-result">
                        <p class="text-sm text-gray-500">Your translation will appear here...</p>
                    </div>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="text-xs text-gray-600">Popular searches:</span>
                        <button class="tag cursor-pointer hover:bg-zen-accent hover:text-white transition-colors" onclick="translateTerm('一期一会')">一期一会</button>
                        <button class="tag cursor-pointer hover:bg-zen-accent hover:text-white transition-colors" onclick="translateTerm('wabi-sabi')">wabi-sabi</button>
                        <button class="tag cursor-pointer hover:bg-zen-accent hover:text-white transition-colors" onclick="translateTerm('tea bowl')">tea bowl</button>
                        <button class="tag cursor-pointer hover:bg-zen-accent hover:text-white transition-colors" onclick="translateTerm('利休')">利休</button>
                        <button class="tag cursor-pointer hover:bg-zen-accent hover:text-white transition-colors" onclick="translateTerm('hakogaki')">hakogaki</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Timeline Section -->
        <section id="timeline" class="content-section mb-12">
            <div class="section-card">
                <h2 class="text-3xl font-bold mb-6">Timeline: From Monastic Tool to Public Heritage</h2>
                <div id="timeline-container" class="relative border-l-4 border-green-700 ml-2">
                    <!-- Timeline items will be inserted here -->
                </div>
            </div>
        </section>

        <!-- Roles Section -->
        <section id="roles" class="content-section mb-12">
            <div class="section-card">
                <h2 class="text-3xl font-bold mb-6">The Ecosystem of Roles</h2>
                <div id="roles-container" class="grid md:grid-cols-2 gap-6">
                    <!-- Role cards will be inserted here -->
                </div>
            </div>
        </section>

        <!-- Temples Section -->
        <section id="temples" class="content-section mb-12">
            <div class="section-card">
                <h2 class="text-3xl font-bold mb-6">Temples: Hubs, Counterpoints, Lineages</h2>
                <p class="text-sm text-gray-600 mb-4 italic">Click on any temple card to learn more about its history and role in tea culture.</p>
                <div class="mb-4 flex flex-wrap gap-2">
                    <span class="text-sm text-gray-600 mr-2">Filter by sect:</span>
                    <button class="filter-badge border border-gray-300 bg-white active" data-filter="All">All</button>
                    <button class="filter-badge border border-gray-300 bg-white" data-filter="Rinzai">Rinzai</button>
                    <button class="filter-badge border border-gray-300 bg-white" data-filter="Kegon">Kegon</button>
                    <button class="filter-badge border border-gray-300 bg-white" data-filter="Jōdo">Jōdo</button>
                    <button class="filter-badge border border-gray-300 bg-white" data-filter="Nichiren">Nichiren</button>
                    <button class="filter-badge border border-gray-300 bg-white" data-filter="Shingon">Shingon</button>
                </div>
                <div id="temples-container" class="grid md:grid-cols-2 gap-4">
                    <!-- Temple cards will be inserted here -->
                </div>
            </div>
        </section>

        <!-- Monks & Bokuseki Section -->
        <section id="monks" class="content-section mb-12">
            <div class="section-card">
                <h2 class="text-3xl font-bold mb-6">Monks & Bokuseki</h2>
                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <h3 class="text-xl font-bold mb-3">Bokuseki (墨蹟): The Alcove's Heart</h3>
                        <p class="text-gray-700 mb-4">
                            Zen calligraphy by esteemed monks is the most revered tokonoma display. The phrase (e.g., <em>日々是好日</em>, <em>一期一会</em>) sets the <em>shudai</em> and guides the ensemble. Brush energy is read as the living trace of discipline and clarity.
                        </p>
                        <div class="accordion-wrapper">
                            <button class="accordion-btn">
                                <span>How bokuseki guides selection</span>
                                <svg class="w-4 h-4 accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div class="accordion-content px-2">
                                <ul class="list-disc pl-5 text-sm text-gray-600 mt-2">
                                    <li>Theme first; utensils should echo the scroll's teaching.</li>
                                    <li>Balance: intense ink energy pairs well with quiet ceramics.</li>
                                    <li>Seasonality: choose phrases aligned to season/occasion.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <h3 class="text-xl font-bold mb-3">The Abbot as Host, Artist, and Arbiter</h3>
                        <p class="text-gray-700 mb-4">
                            High-ranking abbots (esp. at Daitoku-ji) may host tea as direct Zen instruction, brush scrolls, name/carve utensils, and write authoritative box inscriptions (<em>hakogaki</em>) that canonize objects.
                        </p>
                        <div class="accordion-wrapper">
                            <button class="accordion-btn">
                                <span>Listing phrase decoder: 前大徳 [Name] 書付</span>
                                <svg class="w-4 h-4 accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div class="accordion-content px-2">
                                <p class="text-sm text-gray-600 mt-2">
                                    <strong>前大徳</strong> denotes a former abbot of Daitoku-ji; <strong>書付</strong> indicates an inscription/attestation. Together, this signals a premium endorsement—verify hand and seal.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Utensils Explorer Section -->
        <section id="utensils" class="content-section mb-12">
            <div class="section-card">
                <h2 class="text-3xl font-bold mb-6">Utensils Explorer</h2>
                <div class="mb-4 flex flex-wrap gap-2">
                    <span class="text-sm text-gray-600 mr-2">Filter by type:</span>
                    <button class="filter-badge border border-gray-300 bg-white active" data-utensil-filter="All">All</button>
                    <button class="filter-badge border border-gray-300 bg-white" data-utensil-filter="Chawan">Chawan (Tea Bowls)</button>
                    <button class="filter-badge border border-gray-300 bg-white" data-utensil-filter="Chaire">Tea Caddies</button>
                    <button class="filter-badge border border-gray-300 bg-white" data-utensil-filter="Other">Other Utensils</button>
                </div>
                <div id="utensils-container" class="space-y-8">
                    <!-- Utensil cards will be inserted here -->
                </div>
            </div>
        </section>

        <!-- Provenance & Hakogaki Section -->
        <section id="provenance" class="content-section mb-12">
            <div class="section-card">
                <h2 class="text-3xl font-bold mb-6">Provenance & Hakogaki: A Practical Guide</h2>
                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <h3 class="text-xl font-bold mb-3">Reading a Box (Kiribako)</h3>
                        <ul class="list-disc pl-5 text-gray-700 space-y-2">
                            <li><strong>Front:</strong> Object type + title/mei; sometimes era/kiln.</li>
                            <li><strong>Lid underside:</strong> Signature + <em>kaō</em> (stylized seal) of authority.</li>
                            <li><strong>Sides:</strong> Old collection labels, exhibition notes.</li>
                        </ul>
                        <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                            <h4 class="font-semibold mb-2">Common wordings</h4>
                            <dl class="text-sm space-y-2">
                                <dt class="font-semibold">What is hakogaki (箱書)?</dt>
                                <dd class="text-gray-600">Box inscription on kiribako: name/mei, attribution, signer's signature + kaō. Documentary spine for identity and provenance.</dd>
                                <dt class="font-semibold">Who are strong signers?</dt>
                                <dd class="text-gray-600">Senke iemoto (Omote/Ura/Mushanokōji) and senior abbots of major temples (esp. Daitoku-ji).</dd>
                            </dl>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <h3 class="text-xl font-bold mb-3">Due Diligence Checklist</h3>
                        <ul class="list-disc pl-5 text-gray-700 space-y-2">
                            <li>Match handwriting + kaō to known exemplars (abbot/iemoto).</li>
                            <li>Check box carpentry + paper/fabric age vs. claimed period.</li>
                            <li>Confirm object–box fit: wear patterns, ties, internal blocks.</li>
                            <li>Triangulate with museum comparanda and published denrai.</li>
                            <li>Document every change (remounts, relacquers, repairs).</li>
                        </ul>
                        <div class="mt-4 p-4 bg-amber-50 rounded-lg">
                            <h4 class="font-semibold mb-2 text-amber-900">Economics in brief</h4>
                            <p class="text-sm text-amber-800">
                                A credible <em>hakogaki</em> often commands a premium by transforming a good object into a named, canonized piece. Conversely, mismatched or forged inscriptions can invert value. Treat the box as a document, not décor.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Temple Events Section -->
        <section id="events" class="content-section mb-12">
            <div class="section-card">
                <h2 class="text-3xl font-bold mb-6">Temple Events & Formats</h2>
                <div id="events-container" class="grid md:grid-cols-2 gap-4">
                    <!-- Event cards will be inserted here -->
                </div>
            </div>
        </section>

        <!-- Toriawase Lab Section -->
        <section id="toriawase" class="content-section mb-12">
            <div class="section-card">
                <h2 class="text-3xl font-bold mb-6">Toriawase Lab (Ensemble Sandbox)</h2>
                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <h3 class="text-xl font-bold mb-4">Set your theme</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Theme</label>
                                <input type="text" id="theme-input" value="Autumn moon" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Scroll (bokuseki)</label>
                                <input type="text" id="scroll-input" value="一期一会" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800">
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Tea bowl</label>
                                    <select id="bowl-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800">
                                        <option>Ido</option>
                                        <option>Raku</option>
                                        <option>Tenmoku</option>
                                        <option>Shino</option>
                                        <option>Oribe</option>
                                        <option>Hagi</option>
                                        <option>Karatsu</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Tea caddy</label>
                                    <select id="caddy-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800">
                                        <option>Chaire</option>
                                        <option>Natsume</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Flower vase</label>
                                <select id="vase-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800">
                                    <option>Bamboo (node-cut)</option>
                                    <option>Ceramic (Shigaraki)</option>
                                    <option>Bronze hanging</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <h3 class="text-xl font-bold mb-4">Curatorial guidance</h3>
                        <p class="text-gray-700 mb-3 text-sm">General heuristics drawn from orthodox practice and connoisseurship.</p>
                        <ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">
                            <li>Choose a clear shudai (theme): seasonal, literary, or memorial.</li>
                            <li>Balance decorated pieces with quiet anchors; avoid clashing patterns.</li>
                            <li>Do not over-concentrate one maker/kiln; seek textural dialogue.</li>
                            <li>Let bokuseki lead the room; utensils echo the scroll's teaching.</li>
                            <li>Document the set: shifuku, boxes, and notes to build denrai.</li>
                        </ul>
                        <div id="toriawase-notes" class="mt-4 p-4 bg-blue-50 rounded-lg">
                            <h4 class="font-semibold mb-2 text-blue-900">Contextual notes based on your picks</h4>
                            <ul id="context-notes" class="list-disc pl-5 text-sm text-blue-800 space-y-1">
                                <!-- Dynamic notes will appear here -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>


    </main>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content p-8 max-w-3xl mx-4">
            <button id="modal-close" class="absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <div id="modal-body">
                <!-- Modal content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-16 py-8 border-t-2" style="background: var(--zen-secondary); border-color: var(--zen-accent);">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p style="color: var(--zen-text);">© 2025 Chanoyu Interactive. Educational content for the study of the Way of Tea.</p>
            <p class="text-sm mt-2" style="color: var(--zen-text-light);">This site is self-contained for offline use.</p>
        </div>
    </footer>

    <script>
    // Data structures
    const TIMELINE = [
        {
            year: 1191,
            title: "Eisai returns from Song China",
            desc: "Rinzai monk Myōan Eisai brings Zen teachings and powdered tea practice to Japan. Tea aids zazen (wakefulness) and is formalized in monastic charei.",
            tags: ["Zen", "Rinzai", "Origins"]
        },
        {
            year: 1211,
            title: "Kissa Yōjōki (Drinking Tea for Health)",
            desc: "Eisai promotes tea's medicinal value; wins Kamakura patronage and diffuses Zen + tea together.",
            tags: ["Text", "Patronage"]
        },
        {
            year: 1450,
            title: "Murata Jukō & Ikkyū",
            desc: "With guidance from Daitoku-ji abbot Ikkyū, Jukō reframes taste: elevate rustic wamono, pair Zen bokuseki with utensils—seed of wabi-cha.",
            tags: ["Aesthetics", "Wabi-cha"]
        },
        {
            year: 1550,
            title: "Takeno Jōō refines wabi-cha",
            desc: "Consolidates the philosophical and aesthetic program leading toward Rikyū's synthesis.",
            tags: ["Wabi", "Aesthetics"]
        },
        {
            year: 1582,
            title: "Rikyū's synthesis",
            desc: "Small sōan huts, minimal etiquette, domestically guided wares (Raku, Shino, Oribe); tea and Zen seen as one taste (chazen ichimi).",
            tags: ["Rikyū", "Codification"]
        },
        {
            year: 1591,
            title: "Sanmon Incident",
            desc: "Conflict with Toyotomi Hideyoshi culminates in Rikyū's death; illustrates tea's political charge and Daitoku-ji's centrality.",
            tags: ["Politics", "Daitoku-ji"]
        },
        {
            year: 1880,
            title: "First modern Kencha at Kitano Tenman-gū",
            desc: "Tea offerings at shrines/temples go public; from Meiji onward kencha-shiki spread nationwide, re-linking tea and religion in civic space.",
            tags: ["Kencha", "Public Ritual"]
        },
        {
            year: 1940,
            title: "Rikyū 350th memorial at Daitoku-ji",
            desc: "Abbot officiates service; Sen iemoto offer tea; three-day tea gatherings welcome thousands—temple as national cultural stage.",
            tags: ["Memorial", "Temple Venue"]
        }
    ];

    const ROLES = [
        {
            name: "Monk (Zen clergy)",
            bullets: [
                "Spiritual anchor; frames tea as lived Zen (chazen ichimi).",
                "Host (teishu) in temple settings; gatherings as direct teaching.",
                "Artist: bokuseki for tokonoma, chashaku carving/naming (mei).",
                "Arbiter of value: hakogaki (box inscription) authenticates and elevates."
            ],
            details: "Bokuseki is the apex of scroll choices in the alcove; the monk's phrase sets the shudai (theme). A high-ranking abbot's hakogaki (signature + kaō) on a kiribako turns an anonymous utensil into a canonized piece with lineage."
        },
        {
            name: "Tea Master (iemoto / practitioner)",
            bullets: [
                "Creative director: composes toriawase ensembles under a theme.",
                "Guides artisans (e.g., Rikyū⇄Chōjirō → Raku).",
                "Transmits orthodoxy and pedagogy across schools (Senke)."
            ],
            details: "From Jukō to Jōō to Rikyū, the master defines the aesthetic economy of attention—small spaces, rough beauty, moral clarity."
        },
        {
            name: "Artisan (potters, lacquerers, metalworkers, bamboo)",
            bullets: [
                "Translate doctrine into object: Shino, Oribe, Raku, Karatsu, etc.",
                "Institutional ties: Senke Jisshoku (Ten Craftsmen); oniwa-yaki at temples/patrons.",
                "Material diagnostics (kairagi, foot rings, glaze movement) encode connoisseurship."
            ],
            details: "Temple-linked kilns (e.g., Kōdai-ji-gama) and designated families (Jisshoku) institutionalize standards."
        },
        {
            name: "Patron (warriors, merchants, modern sponsors)",
            bullets: [
                "Provide economic engine, spaces, and political cover.",
                "Medieval karamono display → wabi-cha merchant culture → modern cultural tourism."
            ],
            details: "Patronage mediates prestige: from Ashikaga to Hideyoshi to corporate and municipal sponsors."
        }
    ];

    const TEMPLES = [
        { 
            name: "Daitoku-ji", 
            kanji: "大徳寺",
            city: "Kyoto", 
            sect: "Rinzai", 
            roles: ["tea-friendly hub", "memorial venues", "abbots as calligraphers"], 
            notes: "Subtemples host tsukigama (28th); deep ties to Rikyū and later masters.",
            details: "Founded in 1315, Daitoku-ji became the spiritual center of wabi-cha. Its 22 subtemples include Kōtō-in (高桐院) where Hosokawa Tadaoki is buried, and Zuihō-in (瑞峯院) with its famous dry landscape garden. Abbots like Ikkyū and Takuan left profound marks on tea culture through their calligraphy and direct guidance to tea masters."
        },
        { 
            name: "Myōshin-ji", 
            kanji: "妙心寺",
            city: "Kyoto", 
            sect: "Rinzai", 
            roles: ["historically stricter"], 
            notes: "Periods of discouraging tea among clergy; instructive counterpoint to Daitoku-ji.",
            details: "The largest Rinzai temple complex with 46 subtemples. While historically more austere regarding tea practice among monks, it houses important tea rooms including Taizō-in's (退蔵院) yokushitsu, showing the complex relationship between Zen orthodoxy and tea culture."
        },
        { 
            name: "Kōzan-ji", 
            kanji: "高山寺",
            city: "Kyoto", 
            sect: "Kegon", 
            roles: ["tea garden heritage", "annual kencha"], 
            notes: "Myoe planted tea; yearly offering to his spirit with Uji growers.",
            details: "Home to Japan's oldest tea garden, planted by monk Myōe (明恵) in 1206 using seeds from Eisai. The temple maintains the tradition of 'honcha' (本茶) - original tea. Every May, Uji tea growers offer the first harvest in a solemn kencha ceremony."
        },
        { 
            name: "Zōjō-ji", 
            kanji: "増上寺",
            city: "Tokyo", 
            sect: "Jōdo", 
            roles: ["annual kencha"], 
            notes: "Invites iemoto; ritualized civic link.",
            details: "The Tokugawa family temple hosts major kencha ceremonies where Sen family iemoto offer tea to the Buddha. This Pure Land temple demonstrates how tea transcends sectarian boundaries, linking civic, religious, and aesthetic spheres."
        },
        { 
            name: "Ikegami Honmon-ji", 
            kanji: "池上本門寺",
            city: "Tokyo", 
            sect: "Nichiren", 
            roles: ["chasen kuyō"], 
            notes: "Ceremony retiring whisks; material piety.",
            details: "Famous for its annual chasen kuyō (茶筅供養) where used tea whisks are ritually burned in gratitude. This ceremony, held each autumn, reflects the animistic respect for tools central to tea philosophy - acknowledging the spirit within objects."
        },
        { 
            name: "Gokoku-ji", 
            kanji: "護国寺",
            city: "Tokyo", 
            sect: "Shingon", 
            roles: ["capital hub for large tea events"], 
            notes: "Nickname: a 'tea ceremony honzan'.",
            details: "This Shingon temple, founded by the fifth Tokugawa shogun's mother, hosts massive public tea gatherings. Its Geppō-den (月鳳殿) hall accommodates hundreds for simultaneous tea ceremonies, earning its reputation as Tokyo's 'tea ceremony headquarters'."
        }
    ];

    const EVENTS = [
        { kind: "Tsukigama", desc: "Monthly public tea at temple subprecincts; ticketed; practice in historic spaces.", where: ["Daitoku-ji subtemples"], season: "Monthly" },
        { kind: "Kencha / Kencha-shiki", desc: "Tea offering to deity/buddha; temple/shrine partnership; since 1880 widely public.", where: ["Kitano Tenman-gū", "Daitoku-ji", "Zōjō-ji", "Kōzan-ji"], season: "Varies" },
        { kind: "Kuchikiri no chakai", desc: "Seal-cutting of new tea jars; grinding tencha; lectures + kaiseki.", where: ["Gyokurin-in (Daitoku-ji)", "Uji lineages"], season: "November" },
        { kind: "Memorial Chakai", desc: "Annual rites at gravesites or founder halls (e.g., Enshūki at Kohō-an).", where: ["Kohō-an (Daitoku-ji)"], season: "Annual (date by master)" },
        { kind: "Zen + Tea Experiences", desc: "Curated meditation + shōjin ryōri + private tea; high-end cultural tourism.", where: ["Daiji-in (Daitoku-ji)", "Kennin-ji subtemples"], season: "Year-round" }
    ];

    const UTENSIL_TYPES = [
        {
            type: "Chawan (Tea Bowls)",
            subtypes: [
                { 
                    name: "Tenmoku (天目)", 
                    diagnostics: ["conical profile", "thick iron glaze", "oil-spot/hare's fur"], 
                    lineage: "Song Jian ware via Zen refectories; early tea prestige.", 
                    valueDrivers: ["authentic kiln/period", "fine glaze effects", "provenance, temple links"], 
                    pitfalls: ["modern reproductions", "box-object mismatches"] 
                },
                { 
                    name: "Ido (井戸)", 
                    diagnostics: ["wide lip (kōhai)", "kairagi (sharkskin) at foot", "warm feldspathic glaze"], 
                    lineage: "Korean rice bowls elevated by wabi-cha masters.", 
                    valueDrivers: ["foot and clay quality", "patina", "named provenance"], 
                    pitfalls: ["excessively neat copies", "over-polished foot"] 
                },
                { 
                    name: "Raku (楽)", 
                    diagnostics: ["hand-formed", "soft glaze", "lightweight"], 
                    lineage: "Rikyū–Chōjirō collaboration; orthodox wabi ideal.", 
                    valueDrivers: ["family generation", "iemoto ties", "hakogaki"], 
                    pitfalls: ["post-firing alterations", "spurious boxes"] 
                },
                { 
                    name: "Shino / Oribe", 
                    diagnostics: ["Shino: feldspathic pinholes; Oribe: asymmetry, green copper glaze"], 
                    lineage: "Momoyama innovation with master guidance.", 
                    valueDrivers: ["kiln site", "period", "coherent toriawase role"], 
                    pitfalls: ["attribution drift"] 
                },
                {
                    name: "Hagi (萩)",
                    diagnostics: ["soft porous body", "pinkish-white glaze", "visible crazing"],
                    lineage: "Korean potters brought to Hagi domain; prized for transformation through use.",
                    valueDrivers: ["'seven transformations' patina", "old family kilns", "tea-stained crackle"],
                    pitfalls: ["forced aging", "artificial staining"]
                },
                {
                    name: "Karatsu (唐津)",
                    diagnostics: ["sandy clay body", "simple iron decoration", "sturdy foot"],
                    lineage: "Kyushu kilns with Korean influence; 'First Ido, second Raku, third Karatsu'.",
                    valueDrivers: ["e-garatsu painted designs", "Korean potter lineages", "natural ash deposits"],
                    pitfalls: ["modern mass production", "confused attributions"]
                }
            ]
        },
        {
            type: "Chaire & Natsume (Tea Caddies)",
            subtypes: [
                { 
                    name: "Chaire (濃茶)", 
                    diagnostics: ["stoneware", "ivory lid (old)", "silk shifuku"], 
                    lineage: "karamono prestige; named meibutsu.", 
                    valueDrivers: ["named cloth lineage", "hakogaki", "old denrai"], 
                    pitfalls: ["replaced lids/cloth"] 
                },
                { 
                    name: "Natsume (薄茶)", 
                    diagnostics: ["lacquered wood", "form/finish consistency"], 
                    lineage: "Senke Jisshoku lacquer families.", 
                    valueDrivers: ["maker family", "finish quality"], 
                    pitfalls: ["later relacquering"] 
                }
            ]
        },
        {
            type: "Kama / Mizusashi / Kakejiku / Hanaire",
            subtypes: [
                { 
                    name: "Kama (釜)", 
                    diagnostics: ["iron casting seam", "shoulder inscription"], 
                    lineage: "tetsubin/kama smith lineages.", 
                    valueDrivers: ["smith school", "sound", "surface"] 
                },
                { 
                    name: "Mizusashi (水指)", 
                    diagnostics: ["proportion to chawan", "lid fit"], 
                    lineage: "ceramic or lacquer; visual anchor.", 
                    valueDrivers: ["material coherence", "theme fit"] 
                },
                { 
                    name: "Kakejiku (掛軸)", 
                    diagnostics: ["bokuseki content", "paper/mount age"], 
                    lineage: "Zen calligraphy as spiritual theme.", 
                    valueDrivers: ["monk/abbot hand", "phrase relevance"], 
                    pitfalls: ["re-mounted scrolls hiding era"] 
                },
                { 
                    name: "Hanaire (花入)", 
                    diagnostics: ["bamboo nodes", "cut marks"], 
                    lineage: "rustic naturalism; temple garden motifs.", 
                    valueDrivers: ["maker/monk carving", "surface patina"] 
                },
                {
                    name: "Chashaku (茶杓)",
                    diagnostics: ["bamboo node placement", "curve angle", "tip shape"],
                    lineage: "Tea scoop carved by masters/monks; most intimate utensil.",
                    valueDrivers: ["carver identity", "poetic name (mei)", "original筒 (tsutsu) case"],
                    pitfalls: ["posthumous naming", "mismatched cases"]
                }
            ]
        }
    ];

    // Translation dictionary for the translator
    const TRANSLATION_DICTIONARY = [
        { japanese: "茶の湯", romaji: "chanoyu", english: "way of tea", explanation: "The Japanese tea ceremony; an aesthetic and spiritual practice centered on preparing and sharing matcha." },
        { japanese: "茶道", romaji: "chadō", english: "way of tea", explanation: "Alternative reading for the Way of Tea, emphasizing the spiritual path aspect." },
        { japanese: "侘び寂び", romaji: "wabi-sabi", english: "aesthetic of imperfect beauty", explanation: "Finding beauty in imperfection and impermanence." },
        { japanese: "一期一会", romaji: "ichigo ichie", english: "one time one meeting", explanation: "Each tea gathering is unique and will never recur." },
        { japanese: "茶禅一味", romaji: "chazen ichimi", english: "tea and zen are one taste", explanation: "Tea practice and Zen meditation share the same essence." },
        { japanese: "利休", romaji: "rikyū", english: "Sen no Rikyū", explanation: "Greatest tea master who perfected wabi-cha." },
        { japanese: "茶碗", romaji: "chawan", english: "tea bowl", explanation: "The ceramic bowl for drinking matcha." },
        { japanese: "天目", romaji: "tenmoku", english: "tenmoku bowl", explanation: "Conical Chinese tea bowl with dark iron glaze." },
        { japanese: "井戸", romaji: "ido", english: "ido bowl", explanation: "Korean rice bowl adopted for tea." },
        { japanese: "楽", romaji: "raku", english: "raku bowl", explanation: "Hand-formed tea bowl created under Rikyū's guidance." },
        { japanese: "茶杓", romaji: "chashaku", english: "tea scoop", explanation: "Bamboo scoop for transferring matcha." },
        { japanese: "箱書", romaji: "hakogaki", english: "box inscription", explanation: "Authentication written on storage box." },
        { japanese: "前大徳", romaji: "zen-daitoku", english: "former Daitoku-ji abbot", explanation: "Former abbot of Daitoku-ji temple." },
        { japanese: "月釜", romaji: "tsukigama", english: "monthly tea gathering", explanation: "Regular monthly public tea gathering." },
        { japanese: "献茶", romaji: "kencha", english: "tea offering", explanation: "Ritual offering of tea to deity or Buddha." }
    ];



    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        renderTimeline();
        renderRoles();
        renderTemples();
        renderUtensils();
        renderEvents();
        setupNavigation();
        setupFilters();
        setupAccordions();
        setupToriawaseLab();
        setupModal();
        setupTranslator();
    });

    // Render functions
    function renderTimeline() {
        const container = document.getElementById('timeline-container');
        TIMELINE.forEach(item => {
            const div = document.createElement('div');
            div.className = 'relative pl-8 pb-8';
            div.innerHTML = `
                <div class="timeline-dot"></div>
                <div class="bg-white rounded-lg p-4 shadow hover:shadow-lg transition-shadow cursor-pointer">
                    <div class="flex items-baseline justify-between mb-2">
                        <h3 class="text-lg font-bold">${item.title}</h3>
                        <span class="text-sm text-gray-500">${item.year}</span>
                    </div>
                    <p class="text-gray-700 text-sm">${item.desc}</p>
                    <div class="flex flex-wrap gap-1 mt-2">
                        ${item.tags.map(tag => `<span class="px-2 py-1 bg-gray-100 text-xs rounded-full">${tag}</span>`).join('')}
                    </div>
                </div>
            `;
            container.appendChild(div);
        });
    }

    function renderRoles() {
        const container = document.getElementById('roles-container');
        ROLES.forEach(role => {
            const div = document.createElement('div');
            div.className = 'bg-white rounded-lg border border-gray-200 p-6 hover:shadow-lg transition-shadow';
            div.innerHTML = `
                <h3 class="text-xl font-bold mb-3">${role.name}</h3>
                <ul class="list-disc pl-5 space-y-1 text-sm text-gray-700">
                    ${role.bullets.map(b => `<li>${b}</li>`).join('')}
                </ul>
                <p class="mt-4 text-sm text-gray-600 italic">${role.details}</p>
            `;
            container.appendChild(div);
        });
    }

    function renderTemples(filter = 'All') {
        const container = document.getElementById('temples-container');
        container.innerHTML = '';
        const filtered = filter === 'All' ? TEMPLES : TEMPLES.filter(t => t.sect === filter);
        
        filtered.forEach(temple => {
            const div = document.createElement('div');
            div.className = 'temple-card bg-white rounded-lg border border-gray-200 p-4';
            div.innerHTML = `
                <div class="flex items-baseline justify-between mb-2">
                    <h3 class="text-lg font-bold">${temple.name} ${temple.kanji}</h3>
                    <span class="text-sm text-gray-500">${temple.city} · ${temple.sect}</span>
                </div>
                <p class="text-sm text-gray-700 mb-3">${temple.notes}</p>
                <div class="flex flex-wrap gap-1">
                    ${temple.roles.map(r => `<span class="px-2 py-1 bg-gray-100 text-xs rounded-full">${r}</span>`).join('')}
                </div>
            `;
            div.addEventListener('click', () => {
                openModal({
                    title: `${temple.name} ${temple.kanji}`,
                    subtitle: `${temple.city} · ${temple.sect} Buddhism`,
                    content: temple.details,
                    footer: `Roles: ${temple.roles.join(', ')}`
                });
            });
            container.appendChild(div);
        });
    }

    function renderUtensils(filter = 'All') {
        const container = document.getElementById('utensils-container');
        container.innerHTML = '';
        
        const filtered = filter === 'All' ? UTENSIL_TYPES : 
            filter === 'Chawan' ? UTENSIL_TYPES.filter(u => u.type.includes('Chawan')) :
            filter === 'Chaire' ? UTENSIL_TYPES.filter(u => u.type.includes('Chaire')) :
            UTENSIL_TYPES.filter(u => u.type.includes('Kama'));
        
        filtered.forEach(category => {
            const section = document.createElement('div');
            section.innerHTML = `
                <h3 class="text-xl font-bold mb-4">${category.type}</h3>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${category.subtypes.map(item => `
                        <div class="bg-white rounded-lg border border-gray-200 p-4 hover:shadow-lg transition-shadow">
                            <h4 class="font-bold mb-2">${item.name}</h4>
                            ${item.lineage ? `<p class="text-sm text-gray-600 mb-3">${item.lineage}</p>` : ''}
                            <div class="space-y-2">
                                <div class="accordion-wrapper">
                                    <button class="accordion-btn">
                                        <span>Diagnostics</span>
                                        <svg class="w-4 h-4 accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </button>
                                    <div class="accordion-content">
                                        <ul class="list-disc pl-5 text-xs text-gray-600 mt-2">
                                            ${item.diagnostics ? item.diagnostics.map(d => `<li>${d}</li>`).join('') : ''}
                                        </ul>
                                    </div>
                                </div>
                                ${item.valueDrivers ? `
                                <div class="accordion-wrapper">
                                    <button class="accordion-btn">
                                        <span>Value drivers</span>
                                        <svg class="w-4 h-4 accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </button>
                                    <div class="accordion-content">
                                        <ul class="list-disc pl-5 text-xs text-gray-600 mt-2">
                                            ${item.valueDrivers.map(v => `<li>${v}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                                ` : ''}
                                ${item.pitfalls ? `
                                <div class="accordion-wrapper">
                                    <button class="accordion-btn">
                                        <span>Common pitfalls</span>
                                        <svg class="w-4 h-4 accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </button>
                                    <div class="accordion-content">
                                        <ul class="list-disc pl-5 text-xs text-gray-600 mt-2">
                                            ${item.pitfalls.map(p => `<li>${p}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            container.appendChild(section);
        });
        setupAccordions(); // Re-setup accordions for new content
    }

    function renderEvents() {
        const container = document.getElementById('events-container');
        EVENTS.forEach(event => {
            const div = document.createElement('div');
            div.className = 'bg-white rounded-lg border border-gray-200 p-4 hover:shadow-lg transition-shadow';
            div.innerHTML = `
                <div class="flex items-baseline justify-between mb-2">
                    <h3 class="text-lg font-bold">${event.kind}</h3>
                    <span class="text-sm text-gray-500">${event.season}</span>
                </div>
                <p class="text-sm text-gray-700 mb-3">${event.desc}</p>
                <div class="flex flex-wrap gap-1">
                    ${event.where.map(w => `<span class="px-2 py-1 bg-gray-100 text-xs rounded-full">${w}</span>`).join('')}
                </div>
            `;
            container.appendChild(div);
        });
    }



    // Setup functions
    function setupNavigation() {
        const navButtons = document.querySelectorAll('.nav-btn');
        const sections = document.querySelectorAll('.content-section');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const navMenu = document.getElementById('nav-menu');

        navButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetSection = btn.dataset.section;
                
                // Update active button
                navButtons.forEach(b => {
                    b.classList.remove('bg-gray-900', 'text-white');
                    b.classList.add('bg-white', 'border-gray-300');
                });
                btn.classList.remove('bg-white', 'border-gray-300');
                btn.classList.add('bg-gray-900', 'text-white');
                
                // Scroll to section
                document.getElementById(targetSection).scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Close mobile menu if open
                if (navMenu.classList.contains('flex') && window.innerWidth < 768) {
                    navMenu.classList.add('hidden');
                    navMenu.classList.remove('flex');
                }
            });
        });

        // Mobile menu toggle
        mobileMenuBtn.addEventListener('click', () => {
            navMenu.classList.toggle('hidden');
            navMenu.classList.toggle('flex');
        });
    }



    function setupFilters() {
        // Temple filters
        document.querySelectorAll('[data-filter]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('[data-filter]').forEach(b => {
                    b.classList.remove('active');
                });
                btn.classList.add('active');
                renderTemples(btn.dataset.filter);
            });
        });
        
        // Utensil filters
        document.querySelectorAll('[data-utensil-filter]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('[data-utensil-filter]').forEach(b => {
                    b.classList.remove('active');
                });
                btn.classList.add('active');
                renderUtensils(btn.dataset.utensilFilter);
            });
        });
    }

    // Optimized accordion setup - use event delegation
    let accordionInitialized = false;
    
    function setupAccordions() {
        if (accordionInitialized) return; // Prevent multiple event listeners
        accordionInitialized = true;
        
        // Use event delegation on document body for better performance
        document.body.addEventListener('click', (e) => {
            const button = e.target.closest('.accordion-btn');
            if (!button) return;
            
            const content = button.nextElementSibling;
            const icon = button.querySelector('.accordion-icon');
            
            if (content && content.classList.contains('accordion-content')) {
                content.classList.toggle('open');
                if (icon) icon.classList.toggle('rotate');
            }
        });
    }

    function setupToriawaseLab() {
        // Sophisticated analysis engine for toriawase
        const analyzeEnsemble = () => {
            const theme = document.getElementById('theme-input').value.toLowerCase();
            const scroll = document.getElementById('scroll-input').value;
            const bowl = document.getElementById('bowl-select').value;
            const caddy = document.getElementById('caddy-select').value;
            const vase = document.getElementById('vase-select').value;
            
            const notes = [];
            
            // Theme-based analysis
            if (theme.includes('autumn') || theme.includes('fall') || theme.includes('秋')) {
                notes.push("Autumn theme calls for warm earth tones. Consider maple leaf motifs on shifuku or russet-glazed pieces.");
                if (bowl === 'Ido') notes.push("The golden undertones of Ido complement autumn perfectly—its kairagi evokes dried grasses.");
                if (vase === 'Bronze hanging') notes.push("Bronze hanaire with pampas grass (susuki) captures autumn's metallic light.");
            }
            if (theme.includes('moon') || theme.includes('月')) {
                notes.push("Moon viewing demands restraint—let negative space echo lunar quietude.");
                if (bowl === 'Raku') notes.push("Black Raku (kuro-raku) creates a void-like depth, perfect for moon contemplation.");
            }
            if (theme.includes('spring') || theme.includes('春')) {
                notes.push("Spring welcomes color—consider e-Shino with plum blossom underglaze or fresh green Oribe.");
                if (vase === 'Bamboo (node-cut)') notes.push("Fresh-cut bamboo with early wildflowers (violets, yamabuki) embodies spring's emergence.");
            }
            if (theme.includes('memorial') || theme.includes('追善')) {
                notes.push("Memorial gatherings require solemn dignity. Avoid playful or asymmetric pieces.");
                if (bowl === 'Tenmoku') notes.push("Tenmoku's formality and Buddhist origins make it ideal for memorial services.");
            }
            
            // Scroll-based guidance
            const scrollAnalysis = {
                '一期一会': "This scroll demands ultimate sincerity. Every choice should emphasize the unrepeatable nature of this moment. Avoid anything that feels contrived or decorative.",
                '日々是好日': "'Every day is a good day' invites appreciation of the ordinary. Choose humble, well-used pieces that show the beauty of daily practice.",
                '和敬清寂': "The four principles of tea require perfect balance. Each utensil should embody one aspect: harmony (soft glazes), respect (proper proportions), purity (clean lines), tranquility (subdued colors).",
                '松風': "'Pine wind' evokes nature's voice. Emphasize natural materials—unglazed stoneware, bamboo, rough silk.",
                '雲水': "'Clouds and water' suggests flow and impermanence. Pieces with movement in their glazes or organic forms resonate.",
                '無': "The character for 'nothingness' requires maximum restraint. Strip the ensemble to essentials—perhaps only black and earth tones."
            };
            
            // Check for exact scroll matches first
            for (const [key, value] of Object.entries(scrollAnalysis)) {
                if (scroll.includes(key)) {
                    notes.push(value);
                    break;
                }
            }
            
            // If no exact match, analyze scroll content
            if (!notes.some(n => n.includes('scroll'))) {
                if (scroll.includes('心') || scroll.includes('kokoro')) {
                    notes.push("References to 'heart/mind' call for pieces that reveal inner character—visible clay body, natural ash deposits, honest construction.");
                } else if (scroll.includes('水') || scroll.includes('mizu')) {
                    notes.push("Water imagery pairs with pieces showing fluidity—Chosen Karatsu with its running glazes or Hagi with its milky pooling.");
                } else if (scroll.includes('mountain') || scroll.includes('山')) {
                    notes.push("Mountain themes suggest stability and weathering. Bizen or Shigaraki with their crusty, geological surfaces fit perfectly.");
                } else if (scroll.length > 0) {
                    notes.push("Consider how the scroll's brushwork energy relates to your utensils—bold calligraphy can handle decorated pieces, while delicate writing needs quiet companions.");
                }
            }
            
            // Bowl-specific insights
            const bowlInsights = {
                'Ido': {
                    'Chaire': "Ido with chaire creates a Korean-Chinese dialogue—ensure the shifuku bridges these aesthetics with subdued geometry.",
                    'Natsume': "Ido's rusticity can overwhelm delicate natsume. Choose a robust shape with confident lacquer.",
                    'season': "Ido works year-round but excels in autumn when its warm tones match the season."
                },
                'Raku': {
                    'Chaire': "Raku and chaire represent the ultimate wabi pairing—both shaped by Rikyū's vision. Let nothing distract from this historical resonance.",
                    'Natsume': "Raku with natsume risks being too 'Sen school orthodox'—add an unexpected element elsewhere.",
                    'season': "Black Raku deepens winter gatherings; red Raku warms spring dawn ceremonies."
                },
                'Tenmoku': {
                    'Chaire': "Both being karamono, ensure variety—if using yuteki tenmoku, choose a quieter chaire shape.",
                    'Natsume': "Tenmoku's formality clashes with casual natsume unless the theme specifically calls for such contrast.",
                    'season': "Tenmoku's depth suits winter's introspection and formal New Year gatherings."
                },
                'Shino': {
                    'Chaire': "Shino's softness complements chaire's strength—the feldspathic white creates breathing room around the dark stoneware.",
                    'Natsume': "Both being 'soft' aesthetics, add structure elsewhere—perhaps a bold kakejiku or geometric shifuku.",
                    'season': "Shino evokes snow and suits winter, but e-Shino with underglaze painting can celebrate any season."
                },
                'Oribe': {
                    'Chaire': "Oribe's dynamism can fight with elaborate chaire. Choose simple katatsuki form to ground Oribe's energy.",
                    'Natsume': "Oribe and decorated natsume together risk visual chaos—one should be plain.",
                    'season': "Green Oribe resonates with fresh growth—ideal for late spring into summer."
                },
                'Hagi': {
                    'Chaire': "Hagi's transformation through use pairs beautifully with well-traveled chaire showing genuine patina.",
                    'Natsume': "Both invite gentle handling—this combination suits intimate gatherings among close friends.",
                    'season': "Hagi's warmth suits autumn; its 'seven transformations' philosophy fits New Year reflection."
                },
                'Karatsu': {
                    'Chaire': "Korean-influenced Karatsu with Chinese-style chaire creates pan-Asian dialogue—very sophisticated when done right.",
                    'Natsume': "Robust Karatsu can anchor refined natsume—good contrast of folk and urban aesthetics.",
                    'season': "E-garatsu's iron brushwork suits autumn; plain Karatsu works year-round."
                }
            };
            
            if (bowlInsights[bowl]) {
                if (bowlInsights[bowl][caddy]) {
                    notes.push(bowlInsights[bowl][caddy]);
                }
            }
            
            // Vase harmony
            const vaseNotes = {
                'Bamboo (node-cut)': {
                    formal: "Single-node bamboo hanaire maintains tea room's rustic vocabulary while adding organic verticality.",
                    flowers: "Seasonal wildflowers or single camellia branch—never compete with the scroll's message."
                },
                'Ceramic (Shigaraki)': {
                    formal: "Shigaraki's crusty surface and natural ash deposits echo the randomness of nature within controlled space.",
                    flowers: "Can handle bolder arrangements—autumn grasses or spring branches with movement."
                },
                'Bronze hanging': {
                    formal: "Bronze usubata adds temple gravitas—perfect for memorial or highly formal gatherings.",
                    flowers: "Demands elegant restraint—single peony, lotus pod, or pine branch."
                }
            };
            
            if (vaseNotes[vase]) {
                notes.push(vaseNotes[vase].formal);
            }
            
            // Cross-reference checks
            if (bowl === 'Oribe' && vase === 'Bronze hanging') {
                notes.push("⚠️ Oribe's playfulness conflicts with bronze formality—reconsider unless intentionally juxtaposing.");
            }
            if (bowl === 'Tenmoku' && vase === 'Bamboo (node-cut)') {
                notes.push("Tenmoku's Chinese elegance with rustic bamboo creates interesting tension—ensure scroll unifies them.");
            }
            if (caddy === 'Natsume' && theme.includes('memorial')) {
                notes.push("⚠️ Natsume (usucha) may be too casual for memorial—consider switching to chaire for koicha service.");
            }
            
            // General principles
            if (notes.length < 3) {
                notes.push("Remember: one focal point per gathering. If the scroll is powerful, subdue utensils. If featuring a special bowl, choose a quiet scroll.");
            }
            
            // Seasonal awareness
            const month = new Date().getMonth();
            const seasonalHint = [
                "January calls for auspicious motifs—pine, bamboo, plum (shō-chiku-bai).",
                "February's plum blossoms inspire hope before spring—consider red accents.",
                "March celebrates Girls' Day—shell-shaped pieces or soft colors appropriate.",
                "April's cherry blossoms demand restraint—let one sakura reference suffice.",
                "May's fresh tea (shincha) deserves celebration—consider pieces with tea plant motifs.",
                "June's rain (tsuyu) invites water themes—rain dragon patterns or 'wet' glazes.",
                "July's heat calls for visual coolness—glass or pale ceramics, water-themed scrolls.",
                "August's Obon remembrance suits subdued palettes and memorial themes.",
                "September's moon viewing is paramount—ensure nothing competes with lunar contemplation.",
                "October's colored leaves inspire warm palettes—rust, gold, and crimson welcomed.",
                "November's tea year begins with kuchikiri—use your finest, most treasured pieces.",
                "December's winter solstice calls for depth—dark glazes and candlelit intimacy."
            ];
            notes.push(seasonalHint[month]);
            
            const notesContainer = document.getElementById('context-notes');
            notesContainer.innerHTML = notes.map(n => `<li>${n}</li>`).join('');
        };
        
        // Add event listeners
        document.getElementById('theme-input').addEventListener('input', analyzeEnsemble);
        document.getElementById('scroll-input').addEventListener('input', analyzeEnsemble);
        document.getElementById('bowl-select').addEventListener('change', analyzeEnsemble);
        document.getElementById('caddy-select').addEventListener('change', analyzeEnsemble);
        document.getElementById('vase-select').addEventListener('change', analyzeEnsemble);
        
        analyzeEnsemble(); // Initial analysis
    }

    function setupModal() {
        const modal = document.getElementById('modal');
        const modalClose = document.getElementById('modal-close');
        const modalBody = document.getElementById('modal-body');
        
        modalClose.addEventListener('click', () => {
            modal.classList.remove('show');
        });
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('show');
            }
        });
    }
    
    function openModal(data) {
        const modal = document.getElementById('modal');
        const modalBody = document.getElementById('modal-body');
        
        modalBody.innerHTML = `
            <h3 class="text-2xl font-bold mb-2">${data.title}</h3>
            ${data.subtitle ? `<p class="text-gray-600 mb-4">${data.subtitle}</p>` : ''}
            <div class="prose max-w-none">
                <p>${data.content}</p>
            </div>
            ${data.footer ? `<div class="mt-6 pt-4 border-t border-gray-200 text-sm text-gray-600">${data.footer}</div>` : ''}
        `;
        
        modal.classList.add('show');
    }
    
    // Setup translator
    function setupTranslator() {
        const input = document.getElementById('translator-input');
        let debounceTimer;
        
        input.addEventListener('input', (e) => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                if (e.target.value.trim()) {
                    translateTerm(e.target.value);
                } else {
                    document.getElementById('translator-result').innerHTML = '<p class="text-sm text-gray-500">Your translation will appear here...</p>';
                }
            }, 300);
        });
    }

    // Translator function
    function translateTerm(input) {
        const searchTerm = input.toLowerCase().trim();
        const resultDiv = document.getElementById('translator-result');
        
        // Search through comprehensive dictionary
        const results = TRANSLATION_DICTIONARY.filter(entry => 
            entry.japanese.includes(searchTerm) ||
            entry.romaji.toLowerCase().includes(searchTerm) ||
            entry.english.toLowerCase().includes(searchTerm)
        );
        
        if (results.length > 0) {
            let html = '<div class="space-y-3">';
            results.forEach(result => {
                html += `
                    <div class="border-l-4 border-zen-accent pl-3">
                        <div class="flex flex-wrap items-baseline gap-2 mb-1">
                            <span class="text-xl font-bold">${result.japanese}</span>
                            <span class="text-sm" style="color: var(--zen-text-light);">${result.romaji}</span>
                            <span class="text-sm font-medium">${result.english}</span>
                        </div>
                        <p class="text-sm" style="color: var(--zen-text);">${result.explanation}</p>
                    </div>
                `;
            });
            html += '</div>';
            resultDiv.innerHTML = html;
        } else {
            resultDiv.innerHTML = `
                <p class="text-sm text-gray-500">No results found for "${input}". Try searching for related terms or check your spelling.</p>
                <p class="text-xs text-gray-400 mt-2">Tip: You can search in Japanese (茶碗), romaji (chawan), or English (tea bowl).</p>
            `;
        }
    }

    // Make translateTerm globally accessible for quick search buttons
    window.translateTerm = function(term) {
        document.getElementById('translator-input').value = term;
        translateTerm(term);
    };
    </script>
</body>
</html>
